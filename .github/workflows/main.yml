name: Continuous Integration
on: push

jobs:
  build:
    name: Generate PDFs
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: ./action-build
      - uses: actions/upload-artifact@v2
        with:
            name: pdfs
            path: ./*/build/main.pdf
      - name: Extract PDFs for bundling
        run: mkdir gh-pages-bundle && rsync -a --prune-empty-dirs --include '*/' --include '*.pdf' --exclude '*' ./ gh-pages-bundle/
      - name: Generate index
        run: sudo apt-get install tree && cd gh-pages-bundle && tree -H . > index.html
      - name: Deploy to GitHub Pages ðŸš€
        uses: JamesIves/github-pages-deploy-action@3.7.1
        with:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            BRANCH: gh-pages
            FOLDER: gh-pages-bundle
            CLEAN: true
